<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="data.mybatis.mapper.VisiterMapper">

	<insert id="ipinsert" parameterType="String">
		insert into visiter values(#{ip_address},sysdate)
	</insert>
	
	<select id="onedayselect" parameterType="String" resultType="com.spring.ott.vo.VisiterVo">
		select ip_address, count(ip_address) count, to_char(visit_date,'YYYY/MM/DD') visit_date2 from visiter
		group by to_char(visit_date,'YYYY/MM/DD'),ip_address
		having to_char(visit_date,'YYYY/MM/DD')=#{visit_date}
		order by count desc
	</select>
	<select id="alldayselect" resultType="com.spring.ott.vo.VisiterVo">
		select ip_address, count(ip_address) count, to_char(visit_date,'YYYY/MM/DD') visit_date2 from visiter
		group by to_char(visit_date,'YYYY/MM/DD'),ip_address
		order by visit_date2 desc
	</select>
	
	<select id="rankingselect" parameterType="String" resultType="com.spring.ott.vo.VisiterVo">
		
		SELECT * FROM
		( SELECT ip_address, count(ip_address) count, to_char(visit_date,'YYYY/MM/DD') visit_date2 
		from visiter
		group by to_char(visit_date,'YYYY/MM/DD'),ip_address
		having to_char(visit_date,'YYYY/MM/DD')=#{visit_date}
		) 
		WHERE ROWNUM &lt; 6
		order by count desc
		
	</select>
	
	<select id="onedaylog" parameterType="String" resultType="int">
		select count(ip_address) count 
		from visiter 
		where to_char(visit_date,'YYYY/MM/DD')=#{visit_date}
	</select>
	
	
	<!-- 멤버 차트 -->
	<!-- 회원상태 차트 블랙유저,탈퇴유저 -->
	<select id="memberstatus" resultType="com.spring.ott.vo.VisiterVo">
		SELECT *
		FROM (SELECT COUNT(*) count  FROM USERS WHERE black_enabled = 0 AND enabled = 1) A,
		(SELECT COUNT(*) count1 FROM USERS WHERE  enabled = 0) B
	</select>

	<!-- 나이대별 차트 -->
	<select id="memberage" resultType="com.spring.ott.vo.VisiterVo">
		SELECT * FROM
		(SELECT COUNT(*) AGE10  FROM USERS WHERE AGE > 9 AND AGE &lt;  20) AGE10,
		(SELECT COUNT(*) AGE20  FROM USERS WHERE AGE > 19 AND AGE &lt;  30) AGE20,
		(SELECT COUNT(*) AGE30  FROM USERS WHERE AGE > 29 AND AGE &lt;  40) AGE30,
		(SELECT COUNT(*) AGE40  FROM USERS WHERE AGE > 39 AND AGE &lt;  50) AGE40
	</select>


	<select id="DayCount" parameterType="String" resultType="com.spring.ott.vo.VisiterVo">
		SELECT * FROM
		(SELECT COUNT(*) DAY1  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-6) DAY1,
		(SELECT COUNT(*) DAY2  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-5) DAY2,
		(SELECT COUNT(*) DAY3  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-4) DAY3,
		(SELECT COUNT(*) DAY4  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-3) DAY4,
		(SELECT COUNT(*) DAY5  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-2) DAY5,
		(SELECT COUNT(*) DAY6  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = TO_DATE(#{visit_date}, 'YYYY/MM/DD')-1) DAY6,
		(SELECT COUNT(*) DAY7  FROM USERS WHERE to_char(regdate,'YYYY/MM/DD') = #{visit_date}) DAY7
	</select>
	
	
</mapper>